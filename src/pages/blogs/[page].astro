---
import BaseHead from "../../components/BaseHead.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import { SITE_TITLE } from "../../consts";
import { getCollection } from "astro:content";
import ArticleList from "@/components/ArticleList.astro";
import AboutMe from "@/components/AboutMe.astro";
import Pagination from "@/components/Pagination.astro";
import Content from "@/components/Content.astro";

export async function getStaticPaths({ paginate }: { paginate: any }) {
    const allPosts = await getCollection("blog");
    // Sort posts by publication date (newest first)
    const sortedPosts = allPosts.sort(
        (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
    );
    // Return paginated results with 3 posts per page
    return paginate(sortedPosts, { pageSize: 3 });
}

const { page } = Astro.props;
const {
    data: posts,
    url,
    currentPage,
    lastPage,
} = page as {
    data: any[];
    url: {
        current: string;
        prev: string | undefined;
        next: string | undefined;
        first: string | undefined;
        last: string | undefined;
    };
    currentPage: number;
    lastPage: number;
};
---

<!doctype html>
<html lang="en">
    <head>
        <BaseHead
            title={`${SITE_TITLE} - Blog Page ${currentPage}`}
            description="Blog posts listing"
        />
    </head>
    <body class="min-h-screen flex flex-col">
        <Header title={SITE_TITLE} />
        <main class="pt-[56px] flex-1" transition:animate="fade">
            <Content className="my-auto mt-6 flex flex-row">
                <div class="w-full">
                    <h1 class="text-3xl font-bold mb-6">
                        Blogs Page {currentPage}
                    </h1>
                    <ArticleList posts={posts} />

                    <Pagination
                        currentPage={currentPage}
                        lastPage={lastPage}
                        prevUrl={url.prev}
                        nextUrl={url.next}
                        firstUrl={url.first}
                        lastUrl={url.last}
                    />
                </div>
            </Content>
            <Footer />
        </main>
    </body>
</html>
